## 14 因果森林的六大条件

1、为了实现点wise一致性，我们必须假设条件期望函数E[Y(0)|X=x]和E[Y(1)|X=x]都是Lipschitz连续的。这意味着当我们改变输入变量X的值时，输出变量Y在未接受处理（Y(0)）和接受处理（Y(1)）两种状态下的条件平均值的变化是平滑且有界的，即它们的变化率有一个全局上界。
在估计异质处理效应时，这一假设确保了无论我们关注的数据点x处于特征空间的哪个位置，通过因果森林方法得到的处理效应估计将随着样本量的增加逐渐趋近于真实的处理效应值。换句话说，只有当这两个条件期望函数具备Lipschitz连续性，我们才能确保因果森林方法在每一点x上都能有效地估计出精确的个体处理效应，并且当样本容量趋于无穷大时，该估计结果将在每一点上都一致收敛于真实值。


## 14 因果森林的缺点
当样本量相对固定而特征维度增加时，每个树的训练数据不足以涵盖特征空间的所有可能性，这可能导致在构建单颗树时对处理效应的估计不够准确，进而造成整个森林集合的预测结果偏向于训练数据的某些局部特征模式，而不是全局真实的处理效应分布。
如果特征维度很高，每棵树的构建过程中由于特征选择的随机性可能导致各棵树之间的预测结果相关性减弱，但同时也可能导致每棵树自身的预测偏差增大。

简而言之，随机森林在高维数据集下容易受到偏差影响，主要是因为在高维空间中模型复杂性与数据稀疏性之间的平衡难以把控，导致模型倾向于过拟合并集中于训练数据中的某些特征模式，而非真实全面地反映处理效应的异质性。

## 14 因果森林的相关文献
异质性治疗效果和最佳目标政策评估。(2023).
用因果森林估计治疗效果：一种应用（2019）（作者根据数据完整的causalforest的编程与实现）
联邦支出对地方犯罪影响的异质性： 因果森林的证据（2019）
使用机器学习进行医疗保健应用的异质性治疗效果估计：教程与基准（预印本）（2021年）
利用机器学习确定治疗目标：家庭能源使用案例（2021年）
违约对投资的异质性影响： 因果森林在企业融资中的应用（2019）
通过绿色创新和城市资源配置实现可持续发展： 来自机器学习的证据（2023）

## 14 Experiment and Data


针对2018年数据，we adjust estimates for the varying propensity scores between early and late cohorts by inverse probability-weighted estimators。
## 14 Experiment and Data
只有2018年晚期学校的GPA在处理组和对照组间存在显著差异,此外估计的倾向得分集中在其批次平均值附近，在各自治疗组和对照组之间保持平衡。

## 基于因果森林的CATE估计
直方图显示，2017年数据的治疗效果约为0至15个百分点，2018年约为5至20个百分点，2017年使用早期和晚期协变量预测的异质性较为相似，2018年使用晚期协变量的预测的CATE比使用研究开始前的估计更加分散。
## CATE的估计效果评估
尽管理论上保证治疗效果的估计值，但在实际中，数据中既含有信息也含有噪声，因此往往需要非常大的样本才能使理论转化为实际。

因此对于更现实的样本量，CATE的估计值往往会被误判。1、对于每个特别的协变量向量，估计值往往会偏向于总体平均治疗效果，这是因为不会有足够多的观察结果与特定目标相似的X。2、对于信噪比较低的数据，抽样会导致不同协变量上的估计治疗效果分布，从而夸大异质性。
对于稳健性，我们基于两种不同的方法来估计异质性治疗效果，即使用我们知道倾向评分在学校组中是恒定的这一事实（“已知”）或估计来自数据的倾向评分对随机化可能存在的问题具有稳健性（“AIPW”）。

我们在表1中的估计值显著大于零（在5%的显著性水平），证明我们的估计值确实捕获了治疗效果异质性。

## CATE异质性状况分析：
尽管不能真正采纳CATE的估计值（应用于单个个体上），但我们仍然可以通过评估哪些单位的治疗效果高于其他单位（应用于群体上），这仍然是可靠的。
我们根据CATE估计值创建此类群体，通过十倍交叉拟合消除偏差

尽管CATE的估计值是没有被校准的，所以无法评估到每个体实际的因果效应，因此难以评估单个观察结果的治疗效果估计值的准确性，但GATES方法告诉我们，可以对于一个足够大的群体构建的平均治疗效果的估计值仍然是无偏的。

表 5：基于 AIPW 估计值的图 3 四分位数治疗效果的配对差异、 
括号内为标准估计值。粗体估算值表示根据单侧检验在 5%水平上具有统计意义的增长。
根据单侧检验，在 5%的水平上具有统计意义。
![[1713169947913.png]]
这些估计值是对各组平均治疗效果的无偏估计值，因为在将单位分配到组的过程中没有使用第k组单位中的结果，因此得出的估计值是各组平均治疗结果的无模型无偏估计值。

## 导致因果效应异质性的主要特征：
所以我们不能单单仅依靠特征重要性

此外异质性的一个潜在驱动因素是学生是否已经注册，对于FAFSA申请没有注册限制，但往往年中辍学的学生在下一学年的重新注册的可能性往往也比较低。

实验中，入学状态一旦可用，对治疗效果往往会有很高的预测性。两组人数固定的情况下，他对治疗效果的分区效果与我们根据治疗效果估计值将学生分组的效果一样好

但结合前图，即使在被录取的学生中，治疗效果也存在额外的异质性。

入学率作为重要的治疗效果调节因素是直观的，但不是机械的，学生也可能会辍学并重新注册，因此对未注册学生提供治疗仍然是有效的。

相反，似乎只有很小的额外异质性，这使得注册本身就已经成为提醒效果的有力替代。
## Causal vs Predictive Targeting

上一节中，发现学生对提醒的反应存在异质性，如何利用学生对提醒的反映的差异性来提高提醒的针对性。

尽管注册学生已经效果很好，但基于特征信息的目标定位还是有意义的，一是因为注册信息还未获得时，我们是否就可以利用对异质性治疗效果的预测来选择学生发送行为信息提醒。其次，即使已注册的学生中，对于提醒信息的反应仍存在一定的异质性。

## Targeting based on Treatment effect estimates：

研究团队开始评估第三部分中提出的异质性处理效应估计值 ˆτ(x) 对于优化提醒策略的价值。传统的评估方式可能是看预测值 ˆτ(x) 如何精确地估计真实的处理效应 τ(x)，而在这里，研究者们采取了一种不同的角度，不再关注预测质量本身，而是量化如果我们只针对学生群体中的一部分进行定向提醒，能够实现总收益的多大部分。
由于异质性效应很大一部分在于是否进行登记，因此我们也考虑，如果优先提醒那些入学登记概率高的学生。
另外，一种自然的想法是优先提醒那些没有治疗情况下最不可能申请经济援助的学生，因为对于这类学生中提示获益的可能性更大，这种政策也很实用，因为只需要对照组信息。
由于f（x)=E[y!x=x,t=0]，，所以我们可以用任何机器学习预测器，在没有实验的情况下根据可用特征预测截止日期前的申报情况，从而高效实施这一政策。
此外我们也可以根据哪些学生最优可能在戒截止日期前申请，对他们排序
## Targeting based on Treatment effect estimates：
我们的估计表明使用因果森林的治疗效果估计，得到了适度的收益，CATE预测：利用早期协变量，针对50%发放治疗，续费率从36.5%提高到41%（实现了65%）的收益，95%的置信区间也表明优于随机测试，后期协变量的表现基本相同，。

对于预测率进行评估，针对入学率预测最高达的学生发送提醒，发现预测入学率的表现不如因果政策，表明治疗效果中存在预测入学率以外的附加变量，后期采用协变量中的入学率进行发放，政策效果与预测入学率相似。

对于学生在没有治疗情况下申请FAFSA的学生预测申报概率，针对低申报概率的学生给予干预，以此作为消极的baseline，发现其表现相较于因果政策差的多，甚至比随机分配差的多，50%学生进行预测，只能从36.5%提高到38.5%，收益不到三分之一。

针对高申报概率的学生进行排序预测，发现对于大部分目标学生而言，积极baseline甚至优于非参数CATE，这可能原因在于不太可能申请FAFSA的学生也不太可能被提醒说服去申请，相反相对较弱的行为鼓励对于那些已经接近申请的学生来说，这种治疗的效果最火爆，因此首先针对那些不可能申报者的基线政策所取得的效果恰恰与预期效果相反。
## 4 Causal vs Predictive Targeting的结论
虽然积极和消极基线政策在事前可能都是合理的，但我们只是通过实验的事后评估才了解到它们的特性。因果关系方法的 优势在于，它可以完全根据协变量与治疗效果之间的经验关系，直接估算出我们可以预期效果良好的政策，从而不必猜测可能效果良好的政策(或明确测试大量政策)。同时，这个例子也说明了利用基线预测的好处。因此，我们将在下文中分析如何让数据决定如何使用基线预测，以获得两全其美的效果。

## 5.1 Model-based targeting from baseline predictions
我们的上述结果表明，为了更好地确定干预措施的目标，而不是盲目地依赖于临时的预测目标规则，对干预措施的因果效应进行建模是非常重要的。同时，这些结果表明，基线预测与因果效应之间存在密切关系。因此，在本节中，我们将提出这样一个问题:我们是否可以将预测信息和因果关系建模有效结合起来，从而更好地确定干预目标?

在这个模型中，β可以被解释为提醒的效果，即减少麻烦成本或增加更新经济援助的感知价值。

具体来说，在平均结果的中间值时，治疗效果最大。也就是说，当申请概率接近于零或1时，治疗的增量影响较小。下文将对这-关系进行更全面的讨论，并在图8中加以说明。
结果中这种简单的政策都优于因果森林的非参数政策，利用这种半参数政策，我们实现了75%的收益，该政策也大大优于基于预测或入学率的目标选择，这表明除了入学率以外还存在可预测的异质性，该政策也优于positive

## 5.2 Targeting based on a hybrid model that adapts to heterogeneity
请注意，尽管平均效用在基线和治疗中是相加的，但logit模型的非线性形式意味着治疗效应以特定方式随基线变化。具体来说，平均结果的中间值时，治疗效果最大
但如果以对数为单位的恒定治疗效果不能很好的近似治疗效果与baseline的关系时，或者当baseline变化无法捕捉额外变化时，模型可能表现不佳。因此考虑采用混合逻辑回归

这种对治疗效果估计值和基线预测值进行参数化的具体方法的优点是，它可以使模型同时捕捉到多种情况

## 5 Improving Targeting by Combining Predictive and Causal Modeling
logit baseline这种简单的logit模型得出的目标定位政策，均优于因果森林的非参数政策，针对一半的学生就带来了75%的收益，也大大优于基于预测和入学率的目标选择，也由于正基线。

当恒定治疗效果不能很好的近似治疗效果与baseline的关系时，或者存在baseline无法捕捉的额外变化时，模型可能表现不佳。因此采用适应异质性混合模型回归。

该混合logit模型的性能与仅使用基线信息的更简单的logit模型相当或略差，同时在整个过程中均优于基于完全非参数估计的目标。

CATE from Baseline一般而言，我们预计这种方法在治疗效果主要随基线变化，并且治疗效果与基线的简单关系可能不足以表达它们时效果良好。

## 模拟研究
λ表示治疗效果异质性的程度。对于λ = 1，该模型仅基于非参数估计值f（x）和f τ（x）进行模拟。对于λ = 0，该模型假设治疗效应在对数优势中是恒定的，而λ > 1对应于额外的变异。